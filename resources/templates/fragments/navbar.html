<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
	<!-- Fragment de Navbar Reutilizable -->
	<nav th:fragment="navbar(activePage, categories, cartCount, isAuthenticated, username)"
		class="navbar navbar-expand-lg navbar-dark sticky-top">
		<div class="container">
			<!-- Brand -->
			<a class="navbar-brand" th:href="@{/}">
				<i class="logo bi-cpu-fill me-3"></i><span class="me-1">MODATEC</span>
			</a>

			<!-- Mobile Toggle -->
			<button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Navbar Content -->
			<div class="collapse navbar-collapse" id="navbarNav">
				<!-- Left Menu -->
				<ul class="navbar-nav me-auto">
					<!-- Home -->
					<li class="nav-item">
						<a class="nav-link" th:href="@{/}" th:classappend="${activePage == 'home'} ? 'active' : ''">
							<i class="bi bi-house me-1"></i>Inicio
						</a>
					</li>

					<!-- Products -->
					<li class="nav-item">
						<a class="nav-link" th:href="@{/web/products}"
							th:classappend="${activePage == 'products'} ? 'active' : ''">
							<i class="bi bi-grid me-1"></i>Productos
						</a>
					</li>

					<!-- Categories Dropdown -->
					<li class="nav-item dropdown" th:if="${categories != null and !categories.empty}">
						<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
							aria-expanded="false">
							<i class="bi bi-list me-1"></i>Categorías
						</a>
						<ul class="dropdown-menu">
							<li th:each="category : ${categories}">
								<a class="dropdown-item" th:href="@{/web/products(search=${''}, categoryId=${category.id})}"
									th:text="${category.name}">
									Categoría
								</a>
							</li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/web/products}">
									<i class="bi bi-arrow-right me-2"></i>Ver Todas
								</a>
							</li>
						</ul>
					</li>
				</ul>

				<!-- Right Menu -->
				<ul class="navbar-nav">
					<!-- Cart -->


					<li class="nav-item">
						<a class="nav-link" th:href="@{/web/cart}" th:classappend="${activePage == 'cart'} ? 'active' : ''">
							<i class="bi bi-bag me-1"></i>Carrito
							<span class="badge bg-warning text-dark ms-1 cart-count"
								th:text="${cartCount != null ? cartCount : 0}">0</span>
						</a>
					</li>


					<!-- Authentication Menu -->
					<th:block th:if="${isAuthenticated == null or !isAuthenticated}">
						<!-- Not Authenticated -->
						<li class="nav-item">
							<a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal"
								th:classappend="${activePage == 'login'} ? 'active' : ''">
								<i class="bi bi-person me-1"></i> Iniciar Sesión
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#registerModal"
								th:classappend="${activePage == 'register'} ? 'active' : ''">
								<i class="bi bi-person-plus me-1"></i>Registrarse
							</a>
						</li>
					</th:block>

					<th:block th:if="${isAuthenticated != null and isAuthenticated}">
						<!-- Authenticated User Profile Bubble -->
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle d-flex align-items-center user-profile-bubble" href="#"
								role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<!-- Avatar Circle -->
								<div class="user-avatar me-2">
									<span class="avatar-text"
										th:text="${username != null ? username.substring(0,1).toUpperCase() : 'U'}">U</span>
								</div>

							</a>

							<!-- Dropdown Menu: different for ADMIN -->
							<ul class="dropdown-menu dropdown-menu-end user-dropdown">
								<!-- If user is ADMIN, show minimal menu -->
								<th:block th:if="${userRole != null and userRole == 'ADMIN'}">
									<li>
										<a class="dropdown-item" th:href="@{/admin/dashboard}">
											<i class="bi bi-speedometer2 me-2 text-primary"></i>Panel
										</a>
									</li>
									<li>
										<hr class="dropdown-divider">
									</li>
									<li>
										<a class="dropdown-item text-danger" href="#" onclick="logout()">
											<i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
										</a>
									</li>
								</th:block>

								<!-- Otherwise, regular user menu -->
								<th:block th:if="${userRole == null or userRole != 'ADMIN'}">
									<!-- User Info Header -->
									<li class="dropdown-header">
										<div class="d-flex align-items-center">
											<div class="user-avatar-large me-3">
												<span class="avatar-text-large"
													th:text="${username != null ? username.substring(0,1).toUpperCase() : 'U'}">U</span>
											</div>
											<div>
												<div class="fw-semibold fs-5" th:text="${username != null ? username : 'Usuario'}">
													Usuario
												</div>
												<small class="text-muted">En línea</small>
											</div>
										</div>
									</li>
									<li>
										<hr class="dropdown-divider">
									</li>

									<!-- Profile Options -->
									<li>
										<a class="dropdown-item" href="#" th:href="@{/web/user/profile}">
											<i class="bi bi-person me-2 text-primary"></i>Mi Perfil
										</a>
									</li>
									<li>
										<a class="dropdown-item" href="#" th:href="@{/web/user/orders}">
											<i class="bi bi-box me-2 text-info"></i>Mis Pedidos
										</a>
									</li>
									<li>
										<a class="dropdown-item" href="#" th:href="@{/web/user/wishlist}">
											<i class="bi bi-heart me-2 text-danger"></i>Lista de Deseos
										</a>
									</li>
									<li>
										<a class="dropdown-item" href="#" th:href="@{/web/user/settings}">
											<i class="bi bi-gear me-2 text-secondary"></i>Configuración
										</a>
									</li>

									<li>
										<hr class="dropdown-divider">
									</li>

									<!-- Quick Actions -->
									<li>
										<a class="dropdown-item" href="#" th:href="@{/web/support}">
											<i class="bi bi-question-circle me-2 text-info"></i>Ayuda
										</a>
									</li>

									<li>
										<hr class="dropdown-divider">
									</li>

									<!-- Logout -->
									<li>
										<a class="dropdown-item text-danger" href="#" onclick="logout()">
											<i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
										</a>
									</li>
								</th:block>
							</ul>
						</li>
					</th:block>
				</ul>
			</div>
		</div>
	</nav>


</body>

</html>